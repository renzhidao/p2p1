<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>å±€åŸŸç½‘èŠå¤©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <style>
      :root{
        --sidebar-fr: 0.28; --header-fr: 0.10; --send-fr: 0.18;
        --bg: #0e0f13; --panel: #0b0d12; --fg: #e6e6e6; --muted: #9aa7b4; --line: rgba(255,255,255,.08);
        --input-bg: #0a1120; --input-border: #2d3649; --chip: #0d1526; --chip-border: #2e3648; --btn-bg: #1a2234; --btn-border: #354059; --primary: #2a7cff; --thumb: 160px;
      }
      *{ box-sizing: border-box; }
      html, body{
        width:100%; height:100%; margin:0; background: var(--bg); color: var(--fg);
        font-family: ui-sans-serif,-apple-system,system-ui,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial,"Noto Sans","Hiragino Sans GB",sans-serif;
        -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      }
      .shell{ width: 100dvw; height: 100dvh; }
      .app{
        width:100%; height:100%;
        display:grid;
        grid-template-columns: calc(var(--sidebar-fr) * 100%) calc((1 - var(--sidebar-fr)) * 100%);
        grid-template-rows: calc(var(--header-fr) * 100%) calc((1 - var(--header-fr) - var(--send-fr)) * 100%) calc(var(--send-fr) * 100%);
        gap:10px; padding:10px;
      }
      .sidebar{
        grid-column:1; grid-row:1 / span 3;
        background:var(--panel); border:1px solid var(--line); border-radius:12px;
        display:grid; grid-template-rows:auto 1fr; overflow:hidden; min-width:0; min-height:0;
      }
      .sidebar .search{ padding:10px; border-bottom:1px solid var(--line); background:#0c1018; }
      .sidebar .search input{
        width:100%; height:40px; font-size:14px; background:#0f1320; color:#d7e1f2;
        border:1px solid #32394a; border-radius:8px; padding:8px 12px; outline:none;
      }
      .sidebar .list{ padding:10px; overflow:auto; }
      .contact{
        display:grid; grid-template-columns:36px 1fr; gap:8px; align-items:center;
        padding:8px; border:1px solid #232a3a; background:#0e1422; border-radius:10px; margin-bottom:8px; cursor:pointer;
      }
      .contact.active{ border-color:#3b82f6; background:#0d1526; }
      .avatar{ width:36px; height:36px; border-radius:50%; background: linear-gradient(135deg,#5aa1ff,#7ce3ff); }
      .cname{ font-size:13px; color:#cfe3ff; }
      .cmsg{ font-size:12px; color:#8ea0b8; }

      .header{
        grid-column:2; grid-row:1;
        background:var(--panel); border:1px solid var(--line); border-radius:12px;
        display:flex; align-items:center; gap:8px; padding:0 12px; overflow:hidden; min-width:0;
      }
      .chip{ padding:4px 10px; border-radius:999px; font-size:12px; background:var(--chip); border:1px solid var(--chip-border); color:#a9c6ff; white-space:nowrap; }

      .messages{
        grid-column:2; grid-row:2;
        background:var(--panel); border:1px solid var(--line); border-radius:12px;
        padding:10px; display:grid; grid-template-rows:1fr; min-height:0; min-width:0;
      }
      .msg-scroll{ overflow:auto; display:grid; grid-auto-rows:min-content; gap:8px; padding-right:4px; }
      .row{ display:flex; gap:8px; align-items:flex-end; }
      .row.right{ justify-content:flex-end; }
      .bubble{
        max-width:72%; padding:8px 10px; border-radius:12px; font-size:14px; line-height:1.35;
        border:1px solid #2a3142; background:#0f1726; color:#dce8ff; word-break:break-word; min-width:0;
      }
      .bubble.me{ background:#163244; border-color:#23465f; }
      .bubble.file{ background:#0f1c2e; color:#cfe3ff; padding:8px 10px; max-width:280px; }
      .bubble.media{ background:transparent; border:none; padding:0; }
      .file-link{ text-decoration:none; color:inherit; display:block; }
      .file-info{ display:flex; align-items:center; gap:8px; min-width:0; }
      .file-icon{ font-size:24px; flex-shrink:0; }
      .file-name{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

      .thumb-link{ display:inline-block; text-decoration:none; }
      .thumb.img{ width: var(--thumb); height:auto; display:block; border-radius:8px; }
      .thumb.video{ position:relative; width:var(--thumb); border-radius:8px; overflow:hidden; background:#0f1726 center/cover no-repeat; }
      .thumb.video::before{ content:''; display:block; padding-top:56.25%; }
      .thumb.video .play{
        position:absolute; inset:0; display:grid; place-items:center;
        color:#fff; font-size:28px; text-shadow:0 3px 12px rgba(0,0,0,.6);
      }

      .avatar-sm{
        width:28px; height:28px; border-radius:50%;
        display:grid; place-items:center; background: linear-gradient(135deg,#5aa1ff,#7ce3ff);
        flex:0 0 28px; overflow:hidden;
      }
      .avatar-sm .letter{ color:#fff; font-weight:700; font-size:12px; user-select:none; line-height:1; }

      .send{
        grid-column:2; grid-row:3;
        background:var(--input-bg); border:1px solid var(--input-border); border-radius:12px;
        display:grid; grid-template-columns:auto 1fr auto; grid-template-rows:1fr auto; min-width:0; min-height:0;
      }
      .editor{
        grid-column:1 / -1; grid-row:1;
        background:transparent; color:#e5efff; line-height:1.35; font-size:14px;
        outline:none; white-space:pre-wrap; word-break:break-word; overflow:auto; padding:10px;
      }
      .editor:empty:before{ content: attr(data-ph); color: var(--muted); pointer-events:none; }
      .s-left{ grid-column:1; grid-row:2; display:flex; gap:10px; align-items:center; padding:10px; }
      .s-actions{ grid-column:3; grid-row:2; display:flex; gap:10px; align-items:center; padding:10px; }
      .icon{
        display:inline-grid; place-items:center; width:38px; height:38px; border-radius:10px;
        background:var(--btn-bg); border:1px solid var(--btn-border); color:#d8e6ff; font-size:18px; cursor:pointer; user-select:none; flex:0 0 38px;
      }
      .icon input[type=file]{ display:none; }
      .btn{ padding:8px 14px; border-radius:10px; background:var(--btn-bg); border:1px solid var(--btn-border); color:#d8e6ff; font-size:14px; cursor:pointer; }
      .btn.primary{ background:var(--primary); border-color:var(--primary); color:#fff; }
      .btn[disabled]{ opacity:.45; cursor:not-allowed; }

      .send.drag-over{ outline:2px dashed #2a7cff; outline-offset:-6px; }
      @media (max-width: 380px){
        .bubble{ font-size:13px; }
        .editor{ font-size:13px; }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <div class="app">
        <aside class="sidebar" aria-label="è”ç³»äºº">
          <div class="search"><input id="contactSearch" placeholder="æœç´¢è”ç³»äºº" /></div>
          <div class="list" id="contactList"></div>
        </aside>

        <header class="header" aria-label="é¡¶éƒ¨æ ">
          <span class="chip" id="statusChip">æœªè¿æ¥</span>
          <span class="chip" id="onlineChip">åœ¨çº¿ 0</span>
          <span class="chip">èŠå¤©ä¸­</span>
          <span class="chip">å…æ‰“æ‰°</span>
          <span class="chip">ç¾¤è®¾ç½®</span>
        </header>

        <main class="messages" aria-label="æ¶ˆæ¯åˆ—è¡¨">
          <div id="msgScroll" class="msg-scroll"></div>
        </main>

        <section class="send" aria-label="å‘é€åŒº" id="sendArea">
          <div id="editor" class="editor" contenteditable="true" data-ph="è¾“å…¥æ¶ˆæ¯â€¦ å›è½¦å‘é€ï¼ŒShift+Enter æ¢è¡Œ"></div>
          <div class="s-left">
            <button id="emojiBtn" class="icon" title="è¡¨æƒ…">ğŸ˜€</button>
            <label class="icon" title="é™„ä»¶">ğŸ“<input id="fileInput" type="file" multiple /></label>
          </div>
          <div class="s-actions"><button id="sendBtn" class="btn primary" disabled>å‘é€</button></div>
        </section>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.0/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
    <script>
      /* æ ‡è®°ï¼šæ–°é¡µå¤ç”¨é¦–é¡µçš„ app å®ä¾‹ï¼Œä¸å†å•ç‹¬å»ºé“¾ï¼›æ ·å¼ä¿æŒåŸæ · */
      window.__CLASSIC_UI__ = true;
      window.__USE_OPENER_APP__ = !!(window.opener && window.opener.app);
    </script>
    <script src="easytier.js"></script>
  </body>
</html>